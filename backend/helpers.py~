from flask.ext.mail import Message
from backend import app, mail

def commitResponse(session, res, query_object=None):
    "Commits session and returns JSON response"""
    try:
        session.commit()
        if query_object is not None:
            res['data'] = query_object.to_json()
        else: #No query_object means deletion
            res['data'] = 'deletion ok'
    except:
        session.rollback()
    finally:
        return res

def currentTime():
    return time.strftime('%Y-%m-%d %H:%M:%S')

def generateError(msg, code):
    res = {}
    res['error'] = {
        "code": code,
        "message": msg
    }
    return res

def send_email(to, subject, template):
    msg = Message(
        subject,
        recipients=[to],
        html=template,
        sender=app.config['MAIL_DEFAULT_SENDER']
    )
    mail.send(msg)
